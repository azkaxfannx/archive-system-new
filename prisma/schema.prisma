// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  name      String
  nip       String    @unique
  password  String
  role      Role      @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  archives  Archive[]
}

model Archive {
  id                  String       @id @default(uuid())
  kodeUnit            String?
  indeks              String?
  nomorBerkas         String?
  judulBerkas         String?
  nomorIsiBerkas      String?
  jenisNaskahDinas    String?
  klasifikasi         String?
  nomorSurat          String?
  tanggal             DateTime?
  perihal             String?
  tahun               Int?
  tingkatPerkembangan String?
  kondisi             String?
  lokasiSimpan        String?
  retensiAktif        String?
  keterangan          String?
  entryDate           DateTime
  retentionYears      Int
  status              Status       @default(ACTIVE)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  userId              String
  user                User         @relation(fields: [userId], references: [id])

  peminjaman          Peminjaman[]
  serahTerima         SerahTerima?
}

model Peminjaman {
  id                  String    @id @default(uuid())
  nomorSurat          String
  peminjam            String
  keperluan           String
  tanggalPinjam       DateTime
  tanggalHarusKembali DateTime
  tanggalPengembalian DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  archiveId           String
  archive             Archive   @relation(fields: [archiveId], references: [id], onDelete: Cascade)

  @@map("peminjaman")
}

model SerahTerima {
  id                  String              @id @default(uuid())
  
  // Usulan fields (diisi saat usulan)
  pihakPenyerah       String
  pihakPenerima       String
  tanggalUsulan       DateTime            @default(now())
  statusUsulan        StatusUsulan        @default(PENDING)
  
  // Approval fields (diisi setelah diterima)
  nomorBeritaAcara    String?             @unique
  tanggalSerahTerima  DateTime?
  keterangan          String?
  
  // Rejection field
  alasanPenolakan     String?
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  archiveId           String              @unique
  archive             Archive             @relation(fields: [archiveId], references: [id], onDelete: Cascade)

  @@map("serah_terima")
}

enum StatusUsulan {
  PENDING
  APPROVED
  REJECTED
}

enum Status {
  ACTIVE
  INACTIVE
  DISPOSE_ELIGIBLE
}

enum Role {
  ADMIN
  USER
}